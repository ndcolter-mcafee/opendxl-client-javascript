<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: request-manager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: request-manager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict'

var ErrorResponse = require('./error-response')
var RequestError = require('./request-error')

/**
 * @classdesc Manager that tracks outstanding requests and notifies the
 *   appropriate parties (invoking a response callback, notifying a waiting
 *   object, etc.) when a corresponding response is received.
 *
 *   This purpose of this object is to collaborate with a {@link Client}
 *   instance.
 * @private
 * @param {Client} client - The {@link Client} instance through which requests
 *   that this manager tracks are made.
 * @param {String} replyToTopic - The topic that the broker is expected to
 *   publish responses to for the client.
 * @constructor
 */
function RequestManager (client, replyToTopic) {
  /**
   * The {@link Client} instance through which requests that this manager
   * tracks are made.
   * @type {Client}
   * @name RequestManager#_client
   * @private
   */
  this._client = client
  /**
   * The topic that the broker is expected to publish responses to for the
   * client.
   * @type {string}
   * @name RequestManager#_replyToTopic
   * @private
   */
  this.replyToTopic = replyToTopic
  /**
   * Object representing active requests. Each key contains the
   * {@link Message#messageId} of the request. Each corresponding value
   * contains the {@link Response} message received for the request, if one
   * has been received.
   * @type {Object}
   * @name RequestManager#_requests
   * @private
   */
  this._requests = {}
  client.addResponseCallback(replyToTopic, this.onResponse.bind(this), true)
}

/**
 * Performs an asynchronous request via the DXL fabric.
 * @param {Request} request - The request to perform.
 * @param {Function} [responseCallback=null] - The optional callback to be
 *   invoked when the response is received.
 */
RequestManager.prototype.asyncRequest = function (request, responseCallback) {
  this._requests[request.messageId] = responseCallback
  this._client._sendRequest(request)
}

/**
 * Invoked when a {@link Response} has been received. Delivers the response
 * to the corresponding request callback.
 * @param {Response} response - The response message.
 */
RequestManager.prototype.onResponse = function (response) {
  var responseCallback = this._requests[response.requestMessageId]
  if (responseCallback) {
    delete this._requests[response.requestMessageId]
    if (response instanceof ErrorResponse) {
      responseCallback(new RequestError(response), null)
    } else {
      responseCallback(null, response)
    }
  }
}

module.exports = RequestManager
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ResponseErrorCode.html">ResponseErrorCode</a></li></ul><h3>Classes</h3><ul><li><a href="Broker.html">Broker</a></li><li><a href="Client.html">Client</a></li><li><a href="Config.html">Config</a></li><li><a href="DxlError.html">DxlError</a></li><li><a href="ErrorResponse.html">ErrorResponse</a></li><li><a href="Event.html">Event</a></li><li><a href="MalformedBrokerError.html">MalformedBrokerError</a></li><li><a href="Message.html">Message</a></li><li><a href="MessageError.html">MessageError</a></li><li><a href="Request.html">Request</a></li><li><a href="RequestError.html">RequestError</a></li><li><a href="Response.html">Response</a></li><li><a href="ServiceRegistrationInfo.html">ServiceRegistrationInfo</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-installation.html">Installation</a></li><li><a href="tutorial-provisioning.html">Provisioning</a></li><li><a href="tutorial-samples.html">Samples</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
